(function(){"use strict";var e=this;define("socket",["underscore","net","encoding"],function(e,t,n){function o(e){return String.fromCharCode.apply(null,new Uint16Array(e))}var r=[],i=function(){};i.prototype={};var s=e(i.prototype);return s.extend({create:function(n,i,s){var o=new t.Socket,u=r.length;r.push(o),setTimeout(s,0,{socketId:u})}}),s.extend({destroy:function(t){r[t].destroy()}}),s.extend({connect:function(n,i,s,o){var u=r[n];u.connect(s,i,function(){o(0)}),u.resultCode=1,u.buffer=[],u.readCallbacks=[],u.needBytes=0,u.byteCount=0,u.finished=!1,u.on("data",function(t){var n=e(t).map(function(e){return e});u.buffer=u.buffer.concat(n),u.byteCount+=n.length}),u.on("end",function(){u.finished=!0})}}),s.extend({disconnect:function(t){r[t].destroy()}}),s.extend({read:function(t,n,i){var s=r[t],o=setInterval(function(){if(!s.finished)return;clearInterval(o);if(s.byteCount>=n){var e=Math.min(n,s.byteCount);s.byteCount-=e,i({resultCode:1,data:s.buffer.splice(0,e)})}else if(s.byteCount>0){var e=s.byteCount;s.byteCount-=e,i({resultCode:1,data:new ArrayBuffer(s.buffer.splice(0,e))})}else i({resultCode:-1})},10)}}),s.extend({write:function(t,n,i){var s=o(n),u=r[t];u.write(s,function(){i()})}}),new i})}).call(this),function(){"use strict";define("util",["jquery","underscore"],function(e,t){var n=function(){};n.prototype={};var r=t(n.prototype);return r.extend({getDeferredFunc:function(n){return function(){var t=new e.Deferred,r=arguments[arguments.length-1];return r instanceof Function?arguments[arguments.length-1]=function(){r instanceof Function&&r.apply(this,arguments),t.resolve.apply(this,arguments)}:Array.prototype.push.call(arguments,function(){r instanceof Function&&r.apply(this,arguments),t.resolve.apply(this,arguments)}),n.apply(this,arguments),t}}}),new n})}.call(this),function(){define("buffer-lib",["underscore","encoding"],function(e,t){var n=function(){};n.prototype={};var r=e(n.prototype);return r.extend({convertToString:function(n,r){setTimeout(function(){r((new Buffer(t.convert(n,"UTF-8","SJIS"))).toString("UTF-8"))},0)}}),r.extend({convertToBuffer:function(t,n){setTimeout(function(){var e=new ArrayBuffer(t.length*2),r=new Uint16Array(e);for(var i=0;i<t.length;++i)r[i]=t.charCodeAt(i);n(e)},0)}}),new n})}.call(this),function(){"use strict";var e=this;define("http-lib",["jquery","underscore","socket","purl","async","util","buffer-lib"],function(e,t,n,r,i,s,o){function l(t,n){var r=new e.Deferred;return n instanceof Function||(n=r.resolve),o.convertToBuffer(t,n),r}function c(e,t){var n=e.indexOf(t);return[e.substring(0,n),e.substring(n+t.length)]}function h(t){var n=t.split(u),r=n[0].split(" "),i=n.slice(1),s=i.map(function(t){return c(t,":").map(e.trim)}),o={"HTTP-Version":r[0],"Status-Code":r[1]};return s.forEach(function(e){o[e[0]]=e[1]}),o}function p(e){return c(e,u+u)[0]}function d(e){return c(e,u+u)[1]}function v(e){return t(t.keys(e)).map(function(t){return t+"="+e[t]}).join("&")}function m(e){var t=h(p(e)),e={headers:t,body:d(e)};return e}var u="\r\n",a=function(){};a.prototype={};var f=t(a.prototype);f.extend({get:function(s,a,f){function v(e){n.create("tcp",{},function(t){d=t.socketId,e(null)})}function g(e){n.connect(d,p.host,80,function(){var r=[];r.push("GET "+p.path+" HTTP/1.0"+u),t(t.keys(a)).each(function(e){r.push(e+": "+a[e]+u)}),r.push("Connection: close"+u),r.push(u);var i=r.join("");l(i).done(function(t){n.write(d,t,function(){e(null)})})})}function y(e){function u(){n.read(d,256,function(i){if(i.resultCode<0)clearTimeout(s),r=t(r).map(function(e){return e}),n.destroy(d),o.convertToString(r,function(t){c=m(t),e(null)});else{var a=[],f=new Uint8Array(i.data);t(f).each(function(e){a.push(e)}),r=r.concat(a),s=setTimeout(u,0)}})}var r=[],i="",s=setTimeout(u,0)}var c={},h=e.url(s),p={host:h.attr("host"),path:h.attr("path")},d;i.series([v,g,y],function(){f(c)})}}),f.extend({post:function(s,o,a,f){function g(e){n.create("tcp",{},function(t){d=t.socketId,e(null)})}function y(e){n.connect(d,p.host,80,function(){var r=[],i=p.path,s=v(a);p.query!=""&&(i+="?"+p.query),r.push("POST "+i+" HTTP/1.1"+u),t(t.keys(o)).each(function(e){r.push(e+": "+o[e]+u)}),r.push("Connect-Length: "+(new Blob([s])).size+u),r.push("Connection: close"+u),r.push(u),r.push(s);var f=r.join("");l(f).done(function(t){n.write(d,t,function(){e(null)})})})}function b(e){function i(){n.read(d,256,function(s){if(s.resultCode<0)clearTimeout(r),n.destroy(d),c=m(t),e(null);else{var o=new FileReader;o.onloadend=function(){t+=o.result,r=setTimeout(i,0)}}})}var t="",r=setTimeout(i,0)}var c={},h=e.url(s),p={host:h.attr("host"),path:h.attr("path"),query:h.attr("query")},d;i.series([g,y,b],function(){f(c)})}});var g=["get","post"];return t(g).each(function(e){a.prototype[e]=s.getDeferredFunc(a.prototype[e])}),new a})}.call(this),function(){"use strict";var e=this;define("storage",[],function(){return console.log("@storage-node: test"),{}})}.call(this),function(){"use strict";var e=this;define("parser",[],function(){return console.log("@parser: test"),{}})}.call(this),function(){"use strict";var e=this;define("client",["jquery","underscore","http-lib","storage","parser","encoding","util"],function(e,t,n,r,i,s,o){function f(e,t){return"http://"+e+t}function l(e,t){return"/dat/"+t+".dat"}var u=function(){this.HTTP_REQ_HEADERS_DEFAULT={"User-Agent":"Monazilla/1.00"}};u.prototype={};var a=t(u.prototype);a.extend({testHoge:function(){console.log("@hoge: http = ",n)}}),a.extend({getThreadList:function(r,i,s){var o=f(r,"/"+i+"/subject.txt");n.get(o,t(this.HTTP_REQ_HEADERS_DEFAULT).extend({Host:r})).done(function(){s.apply(this,arguments)})}}),a.extend({getSettingText:function(r,i,s){var o=f(r,"/"+i+"/SETTING.TXT");n.get(o,t(this.HTTP_REQ_HEADERS_DEFAULT).extend({Host:r}))}}),a.extend({getResponsesFromThread:function(r,i,s,o){var u=f(r,"/"+i+l(r,s));n.get(u,t(this.HTTP_REQ_HEADERS_DEFAULT).extend({Host:r}))}}),a.extend({putResponseToThread:function(s,o,u,a,l){function p(i){function s(t){var n=[];typeof t.headers["Set-Cookie"]!="undefined"&&n.push(f(t.headers["Set-Cookie"])),e.when.apply(null,n).done(function(){i(t)})}function f(n,i){function s(){return t(n.split(";")).each(function(){var n=SplitString(set_cookie,"="),r=e.trim(n[0]),i=e.trim(n[1]);if(r==="expires"||r==="path")return;var s={};s[r]=i,t(o).extend(s)}),typeof o["HAP"]=="undefined"&&(o.HAP=""),r.set({cookies:o})}var o={};return Array.isArray(n)?e.when.apply(null,t(n).map(f)):e.when.apply(null,[r.get("cookies").done(function(e){t(o).extend(e.cookies)})]).done(s)}var l=t(a).clone();l=t(l).map(function(e){return ConvertToSJIS(e)});var p=t(l).clone(),d=t(t.keys(p)).map(function(e){return EscapeSJIS(p[e]).done(function(t){p[e]=t})});e.when.apply(null,d).done(function(){n.put(c,h,{bbs:o,key:u,time:1,submit:ConvertToSJIS("上記全てを承諾して書き込む"),FROM:p.name,mail:p.mail,MESSAGE:p.body,yuki:"akari"}).done(s)})}function d(e){var n=t.keys(e),r=t(n).map(function(t){return t+"="+e[t]});return r.join("; ")}var c=f(s,"/test/bbs.cgi?guid=ON"),h=t(this.HTTP_REQ_HEADERS_DEFAULT).extend({Host:s,Referer:f(s,"/"+o+"/")});e.when.apply(null,[r.get("cookies").done(function(e){typeof e.cookies!="undefined"&&t(h).extend({Cookie:d(e.cookies)})})]).done(function(){p(l)})}});var c=["getThreadList","getSettingText","getResponsesFromThread","putResponseToThread"];return t(c).each(function(e){u.prototype[e]=o.getDeferredFunc(u.prototype[e])}),new u})}.call(this),function(){"use strict";var e=this;requirejs.config({paths:{client:"./sources/client",socket:"./sources/socket-node",storage:"./sources/storage-node","http-lib":"./sources/http-lib",parser:"./sources/parser","buffer-lib":"./sources/buffer-lib-node",util:"./sources/util",logger:"./sources/logger",encoding:"./lib/encoding"}}),define(["client"],function(e){return e})}.call(this);